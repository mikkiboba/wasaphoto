openapi: 3.0.3
info:
  title: WASAPHOTO APIs
  version: 1.0.0

components:
  securitySchemes:
    bearerAuth:
      type: http
      scheme: bearer
  parameters:
    UserID:
      name: userid
      in: path
      required: true
      schema:
        type: integer
        example: 1
        readOnly: true
    PhotoID:
      name: photoid
      in: path
      required: true
      schema:
        type: integer
        example: 1
        readOnly: true
    LikeID:
      name: likeid
      in: path
      required: true
      schema:
        type: integer
        example: 1
        readOnly: true
    CommentID:
      name: commentid
      in: path
      required: true
      schema:
        type: integer
        example: 1
        readOnly: true
    BanID:
      name: banid
      in: path
      required: true
      schema:
        type: integer
        example: 1
        readOnly: true
    FollowID:
      name: followid
      in: path
      required: true
      schema:
        type: integer
        example: 1
        readOnly: true
  schemas:
    UserId:
      title: UserId
      description: User's ID
      type: object
      properties:
        id:
          description: User's ID
          type: integer
          example: 1
    PhotoInfo:
      title: PhotoInfo
      description: Information about a photo
      type: object
      properties:
        id:
          $ref: "#/components/schemas/PhotoId"
        date:
          description: Photo's upload date
          type: string
          format: date-time
        likes:
          description: Photo's number of likes 
          type: integer
          minimum: 0
        comments:
          description: Photo's number of comments
          type: integer
          minimum: 0
    PhotoId:
      title: PhotoId
      description: Photo's Id
      type: object
      properties:
        id:
          description: Photo's ID
          type: integer
          example: 1
    Stream:
      title: Stream
      description: Stream of photos (timeline)
      type: object
      properties:
        user:
          $ref: "#/components/schemas/UserId"
        array:
          type: array
          items:
            type: object
            properties:
              photo: { $ref: "#/components/schemas/PhotoId" }
              info: { $ref: "#/components/schemas/PhotoInfo" }
    CommentId:
      title: CommentId
      description: Comment's ID
      type: object
      properties:
        id:
          type: integer
          example: 1
    Comment:
      title: Comment
      description: Comment
      type: object
      properties:
        id: 
          $ref: "#/components/schemas/CommentId"
        text:
          type: string
          maxLength: 250
        user:
          $ref: "#/components/schemas/UserId"
    LikeId:
      title: LikeId
      description: Like's ID
      type: object
      properties:
        id:
          type: integer
          example: 1
    Like:
      title: Like
      description: Like
      type: object
      properties:
        id:
          $ref: "#/components/schemas/LikeId"
        photo:
          $ref: "#/components/schemas/PhotoId"
        user:
          $ref: "#/components/schemas/UserId"
    BanId:
      title: BanId
      description: Ban's ID
      type: object
      properties:
        $id:
          type: integer
          example: 1
    Ban:
      title: Ban
      description: Ban
      type: object
      properties:
        id:
          $ref: "#/components/schemas/BanId"
        user:
          $ref: "#/components/schemas/UserId"
        banneduser:
          $ref: "#/components/schemas/UserId"
    FollowId:
      title: FollowId
      description: Follow's ID
      type: object
      properties:
        id:
          type: integer
          example: 1
    Follow:
      title: Follow
      description: Follow between two users
      type: object
      properties:
        id:
          $ref: "#/components/schemas/FollowId"
        user:
          $ref: "#/components/schemas/UserId"
        userfollowed:
          $ref: "#/components/schemas/UserId"
security:
  - bearerAuth: []

paths:
  /session:
    post:
      tags: ["login"]
      summary: Logs in the user
      description: |-
              If the user does not exist, it will be created,
              and an identifier is returned.
              If the user exists, the user identifier is returned.
      operationId: doLogin
      requestBody:
        description: User details
        content:
         application/json:
          schema:
           type: object
           properties:
            name:
              type: string 
              example: Maria
              pattern: 'Ë†.*?$'
              minLength: 3
              maxLength: 16
        required: true
      responses:
       '201':
        description: User log-in action successful
        content:
          application/json:
            schema:
              type: object
              properties:
                identifier:
                # change here if you decide to use an integer
                # or any other type of identifier
                  type: string
                  example: "abcdef012345"

  /profile/{userid}:
    parameters:
      - $ref: "#/components/parameters/UserID"
    put:
      tags: ['profile']
      operationId: setMyUserName
      summary: Set the username
      description: Set the user's username with the specified one
      responses:
        '204':
          description: Username set successfully
        '404':
          description: Username not valid
    
    get:
      tags: ['profile']
      operationId: getUserProfile
      summary: Get a user profile
      description: Get a user profile from the id
      responses:
        '201':
          description: User obtained successfully
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/UserId"

  /profile/{userid}/stream:
    parameters:
      - $ref: "#/components/parameters/UserID"
    post:
      tags: ['profile']
      operationId: uploadPhoto
      summary: Upload a photo
      description: Upload a photo
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/PhotoInfo"
          image/png:
            schema:
              $ref: "#/components/schemas/Stream"
      responses:
        '201':
          description: Photo uploaded succesfully
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/PhotoId"

    get:
      tags: ['profile']
      operationId: getMyStream
      summary: Get the user's stream
      description: Get the user's stream
      responses:
        '201':
          description: Stream obtained successfully
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Stream"

  /profile/{userid}/stream/{photoid}:
    parameters:
      - $ref: "#/components/parameters/UserID"
      - $ref: "#/components/parameters/PhotoID"
    delete:
      tags: ['profile']
      operationId: deletePhoto
      summary: Delete a photo
      description: Delete a photo
      responses:
        '204':
          description: Photo deleted succesfully
  
  /profile/{userid}/stream/{photoid}/likes:
    parameters:
      - $ref: "#/components/parameters/UserID"
      - $ref: "#/components/parameters/PhotoID"
    put:
      tags: ['profile']
      operationId: likePhoto
      summary: Like a photo
      description: Like a photo
      requestBody:
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/PhotoInfo"
      responses:
        '201':
          description: Photo liked successfully
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/LikeId"
  
  /profile/{userid}/stream/{photoid}/likes/{likeid}:
    parameters:
      - $ref: "#/components/parameters/UserID"
      - $ref: "#/components/parameters/PhotoID"
      - $ref: "#/components/parameters/LikeID"
    delete:
      tags: ['profile']
      operationId: unlikePhoto
      summary: Unlike a photo
      description: Delete the like to a photo
      responses:
        '204':
          description: Like deleted successfully
  
  /profile/{userid}/stream/{photoid}/comments:
    parameters:
      - $ref: "#/components/parameters/UserID"
      - $ref: "#/components/parameters/PhotoID"
    put:
      tags: ['profile']
      operationId: commentPhoto
      summary: Comment a photo
      description: Comment a photo
      responses:
        '204':
          description: Photo commented successfully

  /profile/{userid}/stream/{photoid}/comments/{commentid}:
    parameters:
      - $ref: "#/components/parameters/UserID"
      - $ref: "#/components/parameters/PhotoID"
      - $ref: "#/components/parameters/CommentID"
    delete:
      tags: ['profile']
      operationId: uncommentPhoto
      summary: Uncomment a photo
      description: Delete a comment to a photo
      responses:
        '204': 
          description: Comment deleted successfully

  /profile/{userid}/following:
    parameters:
      - $ref: "#/components/parameters/UserID"
    put:
      tags: ['profile']
      operationId: followUser
      summary: Follow a user
      description: Add a user to the list of following
      requestBody:
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/UserId"
      responses:
        '201':
          description: User followed succesfully
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/FollowId"
        '404':
          description: User not found
  
  /profile/{userid}/following/{followid}:
    parameters:
      - $ref: "#/components/parameters/UserID"
      - $ref: "#/components/parameters/FollowID"
    delete:
      tags: ['profile']
      operationId: unfollowUser
      summary: Unfollow a user
      description: Remove a user from the list of following
      responses:
        '204':
          description: User unfollowed successfully

  /profile/{userid}/ban:
    parameters:
      - $ref: "#/components/parameters/UserID"
    put:
      tags: ['profile']
      operationId: banUser
      summary: Ban a user
      description: Ban (block) a user
      requestBody:
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/UserId"
      responses:
        '201':
          description: User banned successfully
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/BanId"
  
  /profile/{userid}/ban/{banid}:
    parameters:
      - $ref: "#/components/parameters/UserID"
      - $ref: "#/components/parameters/BanID"
    delete:
      tags: ['profile']
      operationId: unbanUser
      summary: Unban a user
      description: Unban (unblock) a user
      responses:
        '204':
          description: User unbanned successfully
